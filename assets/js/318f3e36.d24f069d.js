"use strict";(self.webpackChunkdomino_docs=self.webpackChunkdomino_docs||[]).push([[765],{3905:(e,t,i)=>{i.d(t,{Zo:()=>c,kt:()=>f});var n=i(7294);function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function s(e,t){if(null==e)return{};var i,n,o=function(e,t){if(null==e)return{};var i,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(o[i]=e[i]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}var l=n.createContext({}),p=function(e){var t=n.useContext(l),i=t;return e&&(i="function"==typeof e?e(t):a(a({},t),e)),i},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var i=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(i),u=o,f=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return i?n.createElement(f,a(a({ref:t},c),{},{components:i})):n.createElement(f,a({ref:t},c))}));function f(e,t){var i=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=i.length,a=new Array(r);a[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,a[1]=s;for(var p=2;p<r;p++)a[p]=i[p];return n.createElement.apply(null,a)}return n.createElement.apply(null,i)}u.displayName="MDXCreateElement"},9804:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var n=i(7462),o=(i(7294),i(3905));const r={sidebar_position:2},a="Pieces repository",s={unversionedId:"pieces/pieces_repository",id:"pieces/pieces_repository",title:"Pieces repository",description:"The easiest way to start your Pieces repository is to use our Template for Pieces repository.",source:"@site/docs/pieces/pieces_repository.md",sourceDirName:"pieces",slug:"/pieces/pieces_repository",permalink:"/domino-docs/docs/pieces/pieces_repository",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Pieces",permalink:"/domino-docs/docs/pieces/"},next:{title:"Create Pieces",permalink:"/domino-docs/docs/pieces/create_pieces"}},l={},p=[{value:"Piece Folder",id:"piece-folder",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"config.toml",id:"configtoml",level:2},{value:"Github actions",id:"github-actions",level:2}],c={toc:p},d="wrapper";function m(e){let{components:t,...r}=e;return(0,o.kt)(d,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"pieces-repository"},"Pieces repository"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The easiest way to start your Pieces repository is to use our ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Tauffer-Consulting/domino_pieces_repository_template"},"Template for Pieces repository"),".",(0,o.kt)("br",{parentName:"p"}),"\n","You can either clone it using git or use our CLI command ",(0,o.kt)("inlineCode",{parentName:"p"},"domino pieces create"),".")),(0,o.kt)("p",null,"A Pieces repository is a git repository that contains multiple Pieces available to be used in Domino Workflows. A Domino Pieces repository should contain:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"a ",(0,o.kt)("inlineCode",{parentName:"li"},"pieces/")," folder containing all ",(0,o.kt)("a",{parentName:"li",href:"./pieces_repository#piece-folder"},"Pieces")," folders"),(0,o.kt)("li",{parentName:"ul"},"a ",(0,o.kt)("a",{parentName:"li",href:"./pieces_repository#dependencies"},"dependencies/")," folder with all ",(0,o.kt)("inlineCode",{parentName:"li"},"Dockerfile")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"requirements.txt")," files defined as Pieces dependencies"),(0,o.kt)("li",{parentName:"ul"},"a ",(0,o.kt)("a",{parentName:"li",href:"./pieces_repository#configtoml"},"config.toml")," configuration file"),(0,o.kt)("li",{parentName:"ul"},"a ",(0,o.kt)("inlineCode",{parentName:"li"},".domino/")," folder containing the ",(0,o.kt)("inlineCode",{parentName:"li"},"dependencies_map.json")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"compiled_metadata.json")," files, which are automatically generated by the ",(0,o.kt)("a",{parentName:"li",href:"./pieces_repository#github-actions"},"Github"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Repository folders and files structure"',title:'"Repository',folders:!0,and:!0,files:!0,'structure"':!0},"dependencies/\n\u251c\u2500\u2500 Dockerfile_2\n\u2514\u2500\u2500 requirements_1.txt\npieces/\n\u2514\u2500\u2500 FirstPiece/\n    \u251c\u2500\u2500 metadata.json\n    \u251c\u2500\u2500 models.py\n    \u251c\u2500\u2500 piece.py\n    \u2514\u2500\u2500 test_firstpiece.py\n\u2514\u2500\u2500 SecondPiece/\n    \u251c\u2500\u2500 metadata.json\n    \u251c\u2500\u2500 models.py\n    \u251c\u2500\u2500 piece.py\n    \u2514\u2500\u2500 test_secondpiece.py\nconfig.toml\n")),(0,o.kt)("h2",{id:"piece-folder"},"Piece Folder"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"pieces/")," folder should contain all the Pieces in the repository. Each Piece folder name should have the sufix ",(0,o.kt)("inlineCode",{parentName:"p"},"Piece")," and follow a standard organization and contain certain information to be able to be found and used by your deployed Domino instance. Example: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Piece folder example"',title:'"Piece',folder:!0,'example"':!0},"pieces/\n\u2514\u2500\u2500 FirstPiece/\n    \u251c\u2500\u2500 metadata.json\n    \u251c\u2500\u2500 models.py\n    \u2514\u2500\u2500 piece.py\n")),(0,o.kt)("p",null,"For detailed information on how to create a Piece, see ",(0,o.kt)("a",{parentName:"p",href:"./create_pieces"},"Create Pieces"),"."),(0,o.kt)("h2",{id:"dependencies"},"Dependencies"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"/dependencies")," folder should contain all the ",(0,o.kt)("inlineCode",{parentName:"p"},"requirements.txt")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Dockerfile")," files that were defined as dependencies in the ",(0,o.kt)("inlineCode",{parentName:"p"},"metadata.json")," files of the Pieces in this repository. Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Dependencies folder example"',title:'"Dependencies',folder:!0,'example"':!0},"dependencies/\n\u251c\u2500\u2500 Dockerfile_1\n\u251c\u2500\u2500 requirements_1.txt\n\u2514\u2500\u2500 requirements_2.txt\n")),(0,o.kt)("h2",{id:"configtoml"},"config.toml"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"config.toml")," file stores the configuration variables for the repository. Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="Repository\'s configuration file"',title:"\"Repository's",configuration:!0,'file"':!0},'[repository]\n# The name of the github owner, must be in lower-case letters\nREGISTRY_NAME = "github_owner_name"\n\n# The name of this Pieces repository\nREPOSITORY_NAME = "example_pieces"\n\n# The label of this Pieces repository, as it will appear in Domino GUI\nREPOSITORY_LABEL = "OpenAI Domino Pieces"\n\n# The version of this Pieces release\nVERSION = "0.1.0"\n')),(0,o.kt)("h2",{id:"github-actions"},"Github actions"),(0,o.kt)("p",null,"Our ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/Tauffer-Consulting/domino_pieces_repository_template"},"Template for Pieces repository")," provides out-of-the box Github actions to validate, organize and publish your Pieces images.\nWhenever the ",(0,o.kt)("inlineCode",{parentName:"p"},"config.toml")," file of a pieces repository is updated, the actions will run and some files will be automatically created or modified inside the repository's ",(0,o.kt)("inlineCode",{parentName:"p"},"/.domino")," folder:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)("inlineCode",{parentName:"li"},"dependencies_map.json")," file"),(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)("inlineCode",{parentName:"li"},"compiled_metadata.json")," file")),(0,o.kt)("p",null,"Besides that, the actions will also create the following artifacts within the repository:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A ",(0,o.kt)("inlineCode",{parentName:"li"},"VERSION.tar.gz")," file will be created as a release asset"),(0,o.kt)("li",{parentName:"ul"},"Docker images will be built and published to the repository's container registry (in Github this is named Packages). One image will be created for each dependency group, as defined in ",(0,o.kt)("inlineCode",{parentName:"li"},".domino/dependencies_map.json")," file.")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"For the actions to run successfully, make sure that under your repository ",(0,o.kt)("inlineCode",{parentName:"p"},"Settings -> Action -> General -> Workflow permissions")," the option ",(0,o.kt)("inlineCode",{parentName:"p"},"Read and write permissions")," is selected.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Piece repository action",src:i(6645).Z,width:"1380",height:"916"})))}m.isMDXComponent=!0},6645:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/pieces_repository_slide_2-824d81179db7df3cc889c708b49340c9.png"}}]);